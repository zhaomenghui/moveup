<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jp.co.vermore.mapper.ShopTagMapper" >
  <resultMap id="ShopTagResult" type="jp.co.vermore.entity.ShopTag" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 12 10:56:27 CST 2018.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="shop_id" property="shopId" jdbcType="INTEGER" />
    <result column="module_type" property="moduleType" jdbcType="TINYINT" />
    <result column="tag_type" property="tagType" jdbcType="TINYINT" />
    <result column="content" property="content" jdbcType="INTEGER" />
    <result column="create_datetime" property="createDatetime" jdbcType="TIMESTAMP" />
    <result column="update_datetime" property="updateDatetime" jdbcType="TIMESTAMP" />
    <result column="del_flg" property="delFlg" jdbcType="BIT" />
    <result column="note" property="note" jdbcType="VARCHAR" />
  </resultMap>

  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 12 10:56:27 CST 2018.
    -->
    id, shop_id, module_type,tag_type, content, create_datetime, update_datetime, del_flg, note
  </sql>
  <select id="getContent" resultType="Integer">
    select content
    from shop_tag
    where shop_id = #{param1}
    AND del_flg = 0
    AND module_type = #{param2}
    AND tag_type = #{param3}
    order by create_datetime desc
  </select>

  <select id="getShopTagList" resultMap="ShopTagResult">
    select  *
    from shop_tag
    where shop_id in
    <foreach collection="param1" item="ent" separator="," open="(" close=")">
    #{ent}
    </foreach>
    <if test="param2 != null and param2 != 0 and param2 != 2 and param2 != 8" >
      and module_type = #{param2}
    </if>
    AND tag_type in
    <foreach collection="param3" item="ent" separator="," open="(" close=")">
      #{ent}
    </foreach>
    AND del_flg = 0
  </select>

  <select id="getContents" resultType="Integer">
    select  content
    from shop_tag
    where shop_id = #{param1}
    AND module_type = #{param2}
    AND tag_type = #{param3}
    AND del_flg = 0
  </select>

  <select id="getShopId" resultType="Integer">
  select shop_id
  from shop_tag
  where
  module_type = #{shopType}
  AND
   del_flg = 0
  </select>

  <select id="getShopIdByContent" resultType="Long">
    select shop_id
    from shop_tag
    where
    <if test="param1 != null and param1 != 0">
      module_type = #{param1} AND
    </if>
    tag_type = #{param2}
    AND
    <choose>
      <when test="param2 == 2">
          content != 0 AND content &gt;= #{param3}
      </when>
      <when test="param2 == 16">
          content != 0 AND content &lt;= #{param3}
      </when>
      <when test="param2 == 3">
          content != 0 AND content &gt;= #{param3}
      </when>
      <when test="param2 == 17">
          content != 0 AND content &lt;= #{param3}
      </when>
      <when test="param2 == 5">
          content != 0 AND content &lt;= #{param3}
      </when>
      <when test="param2 == 9">
          content != 0 AND content >= #{param3}
      </when>
      <otherwise>
        content = #{param3}
      </otherwise>
    </choose>
    AND
    del_flg = 0
  </select>

  <select id="getShopIdByContents" resultType="Long">
    select shop_id
    from shop_tag
    where
    <if test="param1 != null and param1 != 0">
      module_type = #{param1} AND
    </if>
    tag_type = #{param2}
    AND
    content in
    <foreach collection="param3" item="ent" separator="," open="(" close=")">
      #{ent,jdbcType=INTEGER}
    </foreach>
    AND del_flg = 0
  </select>

  <insert id="insertShopTag">
    insert into shop_tag(
    shop_id,
    module_type,
    tag_type,
    content,
    create_datetime,
    update_datetime,
    del_flg,
    note
    ) values (
    #{shopId},
    #{moduleType},
    #{tagType},
    #{content},
    #{createDatetime},
    #{updateDatetime},
    #{delFlg},
    #{note}
    )
    <selectKey resultType="long" keyProperty="id" order="AFTER">
      select @@IDENTITY
    </selectKey>
  </insert>

  <update id="updateShopTag">
    update shop_tag
    set
    content = #{content},
    create_datetime = #{createDatetime},
    update_datetime = #{updateDatetime},
    del_flg = #{delFlg},
    note = #{note}
    where shop_id = #{shopId}
    and module_type = #{moduleType}
    and tag_type = #{tagType}
  </update>

  <update id="deleteShopTag">
    update shop_tag set del_flg = '1' where shop_id = #{shopId}
  </update>

  <delete id="deleteShopTags">
      update   shop_tag  set del_flg = 1 where  shop_id = #{param1} and module_Type=#{param2} and tag_type = #{param3}
  </delete>

  <select id="getShopTagAllByShopIdListAndCondition" resultMap="ShopTagResult">
    select *
    from shop_tag
    where del_flg = 0
    <if test="param1 != null">
      and shop_id in
      <choose>
        <when test="param1.size > 0">
      <foreach collection="param1" item="ent" separator="," open="(" close=")">
        #{ent}
      </foreach>
        </when>
        <otherwise>
          (0)
        </otherwise>
      </choose>
    </if>
    <if test="param2 > 0">
      and module_type = #{param2}
    </if>
    <if test="param3 > 0">
      and tag_type = #{param3}
    </if>
    <if test="param4 != null and param4.size > 0">
      and content in
      <foreach collection="param4" item="ent" separator="," open="(" close=")">
        #{ent}
      </foreach>
    </if>
  </select>

</mapper>