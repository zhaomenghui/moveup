<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jp.co.vermore.mapper.RecruitTagMapper" >
  <resultMap id="RecruitTagResult" type="jp.co.vermore.entity.RecruitTag" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 12 10:56:27 CST 2018.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="recruit_id" property="recruitId" jdbcType="INTEGER" />
    <result column="tag_type" property="tagType" jdbcType="TINYINT" />
    <result column="content" property="content" jdbcType="INTEGER" />
    <result column="create_datetime" property="createDatetime" jdbcType="TIMESTAMP" />
    <result column="update_datetime" property="updateDatetime" jdbcType="TIMESTAMP" />
    <result column="del_flg" property="delFlg" jdbcType="BIT" />
    <result column="note" property="note" jdbcType="VARCHAR" />
  </resultMap>

  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Mar 12 10:56:27 CST 2018.
    -->
    id, recruit_id, tag_type, content, create_datetime, update_datetime, del_flg, note
  </sql>

    <insert id="insertSelective" parameterType="jp.co.vermore.entity.RecruitTag" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Mar 15 14:32:54 JST 2018.
        -->
        insert into recruit_tag
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="id != null" >
                id,
            </if>
            <if test="recruitId != null" >
                recruit_id,
            </if>
            <if test="tagType != null" >
                tag_type,
            </if>
            <if test="content != null" >
                content,
            </if>
            <if test="createDatetime != null" >
                create_datetime,
            </if>
            <if test="updateDatetime != null" >
                update_datetime,
            </if>
            <if test="delFlg != null" >
                del_flg,
            </if>
            <if test="note != null" >
                note,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="id != null" >
                #{id,jdbcType=INTEGER},
            </if>
            <if test="recruitId != null" >
                #{recruitId,jdbcType=INTEGER},
            </if>
            <if test="tagType != null" >
                #{tagType,jdbcType=INTEGER},
            </if>
            <if test="content != null" >
                #{content,jdbcType=INTEGER},
            </if>
            <if test="createDatetime != null" >
                #{createDatetime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateDatetime != null" >
                #{updateDatetime,jdbcType=TIMESTAMP},
            </if>
            <if test="delFlg != null" >
                #{delFlg,jdbcType=BIT},
            </if>
            <if test="note != null" >
                #{note,jdbcType=VARCHAR},
            </if>
        </trim>
        <selectKey resultType="long" keyProperty="id" order="AFTER">
            select @@IDENTITY
        </selectKey>
    </insert>

  <select id="getContent" resultType="Integer">
    select content
    from recruit_tag
    where recruit_id = #{param1}
    AND
    del_flg = 0
    AND
    tag_type = #{param2}
  </select>

    <delete id="deleteTags">
        delete from recruit_tag
        where recruit_id = #{param1}
        AND
        tag_type = #{param2}
    </delete>

    <delete id="deleteTag">
        delete from recruit_tag
        where recruit_id = #{param1}
        AND tag_type = #{param2}
        AND content = #{param3}
    </delete>

    <select id="getDescByRecruit" resultType="String">
        select td.`desc`
        from recruit_tag as rt left join tag_detail as td on td.module_type = 2 and td.tag_type = #{param2} and rt.content = td.content
        where rt.recruit_id = #{param1}
        AND
        rt.del_flg = 0
        AND
        rt.tag_type = #{param2}
    </select>

  <select id="getShopId" resultMap="RecruitTagResult">
    select recruit_id
    from recruit_tag
    where del_flg = 0
    AND
    tag_type = #{param1}
    AND
    content = #{param2}
  </select>

    <select id="getRecruitTagList" resultMap="RecruitTagResult">
        select *
        from recruit_tag
        where del_flg = 0 and
        recruit_id in
        <foreach collection="param1" item="ent" separator="," open="(" close=")">
            #{ent}
        </foreach>
        AND
        tag_type in
        <foreach collection="param2" item="ent" separator="," open="(" close=")">
            #{ent,jdbcType=INTEGER}
        </foreach>

    </select>

    <select id="getRecruitTagAllByRecruitIdListAndCondition" resultMap="RecruitTagResult">
        select *
        from recruit_tag
        where del_flg = 0
        and recruit_id in
        <foreach collection="param1" item="ent" separator="," open="(" close=")">
            #{ent}
        </foreach>
        <if test="param2 > 0 and param2 != 0">
            and tag_type = #{param2}
        </if>
        <if test='param3 != null and param3.size > 0  '>
            and content in
            <foreach collection="param3" item="ent" separator="," open="(" close=")">
                #{ent}
            </foreach>
        </if>
    </select>

    <select id="getRecruitTagAllByRecruitIdListAndConditionTimeStart" resultMap="RecruitTagResult">
        select *
        from recruit_tag
        where del_flg = 0
        and recruit_id in
        <foreach collection="param1" item="ent" separator="," open="(" close=")">
            #{ent}
        </foreach>
        <if test="param2 > 0">
            and tag_type = #{param2}
        </if>
        <if test="param3 > 0">
            and content &gt;= #{param3}
        </if>
    </select>

    <select id="getRecruitTagAllByRecruitIdListAndConditionTimeEnd" resultMap="RecruitTagResult">
        select *
        from recruit_tag
        where del_flg = 0
        and recruit_id in
        <foreach collection="param1" item="ent" separator="," open="(" close=")">
            #{ent}
        </foreach>
        <if test="param2 > 0">
            and tag_type = #{param2}
        </if>
        <if test="param3 > 0">
            and content &lt;= #{param3}
        </if>
    </select>



</mapper>