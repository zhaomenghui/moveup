<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jp.co.vermore.mapper.ShopMapper">
    <resultMap id="ShopResult" type="jp.co.vermore.entity.Shop">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Mar 12 10:56:27 CST 2018.
        -->
        <id column="id" property="id" jdbcType="BIGINT"/>
        <id column="uuid" property="uuid" jdbcType="VARCHAR"/>
        <result column="shop_type" property="shopType" jdbcType="INTEGER"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="coordinate1" property="coordinate1" jdbcType="INTEGER"/>
        <result column="coordinate2" property="coordinate2" jdbcType="INTEGER"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="excerpt" property="excerpt" jdbcType="VARCHAR"/>
        <result column="now4" property="now4" jdbcType="BIT"/>
        <result column="now5" property="now5" jdbcType="BIT"/>
        <result column="pic_url" property="picUrl" jdbcType="VARCHAR"/>
        <result column="publish_start" property="publishStart" jdbcType="TIMESTAMP"/>
        <result column="publish_end" property="publishEnd" jdbcType="TIMESTAMP"/>
        <result column="create_datetime" property="createDatetime" jdbcType="TIMESTAMP"/>
        <result column="update_datetime" property="updateDatetime" jdbcType="TIMESTAMP"/>
        <result column="del_flg" property="delFlg" jdbcType="BIT"/>
        <result column="note" property="note" jdbcType="VARCHAR"/>

    </resultMap>

    <resultMap id="ShopForListResult" type="jp.co.vermore.entity.ShopForList">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Mar 12 10:56:27 CST 2018.
        -->
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="shop_type" property="shopType" jdbcType="INTEGER"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="tel" property="tel" jdbcType="VARCHAR"/>
        <result column="now4" property="now4" jdbcType="BIT"/>
        <result column="now5" property="now5" jdbcType="BIT"/>
        <result column="publish_start" property="publishStart" jdbcType="TIMESTAMP"/>
        <result column="publish_end" property="publishEnd" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Mar 12 10:56:27 CST 2018.
        -->
        id,uuid, shop_type,name,coordinate1, coordinate2, address, excerpt,now4,now5,pic_url, publish_start,
        publish_end, create_datetime, update_datetime, del_flg, note
    </sql>

    <select id="getShopJsonAll" resultMap="ShopResult" parameterType="int">
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
        <if test="param1 != 0 ">
            and shop_type = #{param1}
        </if>
        and publish_start &lt; #{param2}
        and publish_end &gt;= #{param3}
        LIMIT #{param4} OFFSET #{param5};
    </select>

    <select id="getShopAllCount" resultMap="ShopResult" parameterType="int">
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
        <if test="param1 != 0 ">
            and shop_type = #{param1}
        </if>
        and publish_start &lt; #{param2}
        and publish_end &gt;= #{param3}
    </select>

    <select id="getShopByCoupon" resultMap="ShopResult" >
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0 and now4 = 1
        <if test="param1 != 0">
            and shop_type = #{param1}
        </if>
        and publish_start &lt; #{param2}
        and publish_end &gt;= #{param3}
        order by update_datetime desc
        LIMIT #{param4} OFFSET #{param5};
    </select>

    <select id="getShopByCoupon2" resultMap="ShopResult" >
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
        <if test="param1 != null and param1.size>0">
            and id in
            <foreach collection="param1" item="ent" separator="," open="(" close=")">
                #{ent}
            </foreach>
        </if>
        <if test="param2 != 0">
            and shop_type = #{param2}
        </if>
        and publish_start &lt; #{param3}
        and publish_end &gt;= #{param4}
        <if test="param1 != null and param1.size>0">
        order by field
            <foreach collection="param1" item="ent" separator="," open="(id," close=")">
                #{ent}
            </foreach>
        </if>
        LIMIT #{param5} OFFSET #{param6};
    </select>

    <select id="getShopByCoupon3" resultMap="ShopResult" >
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
        <if test="param1 != null and param1.size>0">
            and id in
            <foreach collection="param1" item="ent" separator="," open="(" close=")">
                #{ent}
            </foreach>
        </if>
        <if test="param2 != 0">
            and shop_type = #{param2}
        </if>
        and publish_start &lt; #{param3}
        and publish_end &gt;= #{param4}
        <if test="param1 != null and param1.size>0">
            order by field
            <foreach collection="param1" item="ent" separator="," open="(id," close=")">
                #{ent}
            </foreach>
        </if>
    </select>

    <select id="getShopAllByCoupon" resultMap="ShopResult" >
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0 and now4 = 1
        <if test="param1 != 0">
            and shop_type = #{param1}
        </if>
        and publish_start &lt; #{param2}
        and publish_end &gt;= #{param3}
    </select>

    <select id="getShopByNow5" resultMap="ShopResult" >
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0 and now5 = 1
        <if test="param1 != 0">
            and shop_type = #{param1}
        </if>
        and publish_start &lt; #{param2}
        and publish_end &gt;= #{param3}
        LIMIT #{param4} OFFSET #{param5};
    </select>

    <select id="getShopByNow5All" resultMap="ShopResult" >
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0 and now5 = 1
        <if test="param1 != 0">
            and shop_type = #{param1}
        </if>
        and publish_start &lt; #{param2}
        and publish_end &gt;= #{param3}
    </select>

    <select id="getShopList" resultMap="ShopResult" parameterType="jp.co.vermore.validation.ShopListParams">
        select
        <include refid="Base_Column_List"/>
        from shop
        WHERE
        <if test="shopType != null and shopType != 0">
            shop_type = #{shopType}
        </if>
        <if test="shopType != null and shopType != 0 and idList != null and idList.size>0">
            AND
        </if>
        <if test="idList != null and idList.size>0">
            id in
            <foreach collection="idList" item="ent" separator="," open="(" close=")">
                #{ent}
            </foreach>
        </if>
        <if test="now4 != null and now4 !=0">
        and now4 = #{now4}
        </if>
        <if test="now5 != null and now5 !=0">
         and now5 =#{now5}
        </if>
        and del_flg = 0
        and publish_start &lt; #{tomorrow}
        and publish_end &gt;= #{today}
        <if test="idList != null and idList.size>0">
            order by field
            <foreach collection="idList" item="ent" separator="," open="(id," close=")">
                #{ent}
            </foreach>
        </if>
        <if test="limit != null ">
        limit #{limit}
        </if>
        <if test="offset != null">
        offset  #{offset}
        </if>
    </select>

    <select id="getShopListCount" resultMap="ShopResult" parameterType="jp.co.vermore.validation.ShopListParams">
        select
        <include refid="Base_Column_List"/>
        from shop
        WHERE
        <if test="shopType != null and shopType != 0">
            shop_type = #{shopType}
        </if>
        <if test="shopType != null and shopType != 0 and idList != null and idList.size>0">
            AND
        </if>
        <if test="idList != null and idList.size>0">
            id in
            <foreach collection="idList" item="ent" separator="," open="(" close=")">
                #{ent}
            </foreach>
        </if>
        <if test="now4 != null and now4 !=0">
            and now4 = #{now4}
        </if>
        <if test="now5 != null and now5 !=0">
            and now5 =#{now5}
        </if>
        and del_flg = 0
        and publish_start &lt; #{tomorrow}
        and publish_end &gt;= #{today}
    </select>

    <select id="getCorporateInfoList" resultMap="ShopResult" parameterType="jp.co.vermore.validation.CorporateInfoListParams">
        select
        <include refid="Base_Column_List"/>
        from shop
        WHERE
            shop_type = 8
        <if test="idList != null and idList.size>0">
            AND id in
            <foreach collection="idList" item="ent" separator="," open="(" close=")">
                #{ent}
            </foreach>
        </if>
        and del_flg = 0
        and publish_start &lt; #{tomorrow}
        and publish_end &gt;= #{today}
        <if test="limit != null ">
            limit #{limit}
        </if>
        <if test="offset != null">
            offset  #{offset}
        </if>
    </select>

    <insert id="insertShop">
        insert into shop(
        <if test="uuid != null" >
            uuid,
        </if>
        <if test="shopType != null" >
        shop_type,
        </if>
        <if test="name != null" >
        `name`,
        </if>
        <if test="coordinate1 != null" >
        coordinate1,
        </if>
        <if test="coordinate2 != null" >
        coordinate2,
        </if>
        <if test="address != null" >
        address,
        </if>
        <if test="excerpt != null" >
        excerpt,
        </if>
        <if test="picUrl != null" >
        pic_url,
        </if>
        <if test="now4 != null" >
         now4,
        </if>
        <if test="now5 != null" >
        now5,
        </if>
        <if test="publishStart != null" >
        publish_start,
        </if>
        <if test="publishEnd != null" >
        publish_end,
        </if>
        <if test="createDatetime != null" >
        create_datetime,
        </if>
        <if test="updateDatetime != null" >
        update_datetime,
        </if>
        <if test="delFlg != null" >
        del_flg,
        </if>
        <if test="note != null" >
        note
        </if>
        ) values (
        <if test="uuid != null" >
            #{uuid},
        </if>
        <if test="shopType != null" >
        #{shopType},
        </if>
        <if test="name != null" >
        #{name},
        </if>
        <if test="coordinate1 != null" >
        #{coordinate1},
        </if>
        <if test="coordinate2 != null" >
        #{coordinate2},
        </if>
        <if test="address != null" >
        #{address},
        </if>
        <if test="excerpt != null" >
        #{excerpt},
        </if>
        <if test="picUrl != null" >
        #{picUrl},
        </if>
        <if test="now4 != null" >
         #{now4},
        </if>
        <if test="now5 != null" >
        #{now5},
        </if>
        <if test="publishStart != null" >
        #{publishStart},
        </if>
        <if test="publishEnd != null" >
        #{publishEnd},
        </if>
        <if test="createDatetime != null" >
        #{createDatetime},
        </if>
        <if test="updateDatetime != null" >
        #{updateDatetime},
        </if>
        <if test="delFlg != null" >
        #{delFlg},
        </if>
        <if test="note != null" >
        #{note}
        </if>
        )
        <selectKey resultType="long" keyProperty="id" order="AFTER">
            select @@IDENTITY
        </selectKey>
    </insert>

    <update id="updateShop">
        update shop
        set
        <if test="coordinate1 != null" >
        coordinate1 = #{coordinate1},
        </if>
        <if test="coordinate2 != null" >
        coordinate2 = #{coordinate2},
        </if>
        <if test="name != null" >
        `name` = #{name},
        </if>
        <if test="address != null" >
        address = #{address},
        </if>
        <if test="excerpt != null" >
        excerpt = #{excerpt},
        </if>
        <if test="now4 != null" >
         now4 = #{now4,jdbcType=BIT},
        </if>
        <if test="now5 != null" >
        now5 = #{now5,jdbcType=BIT},
        </if>
        <if test="picUrl != null" >
        pic_url = #{picUrl},
        </if>
        <if test="publishStart != null" >
        publish_start = #{publishStart},
        </if>
        <if test="publishEnd != null" >
        publish_end = #{publishEnd},
        </if>
        <if test="createDatetime != null" >
        create_datetime = #{createDatetime},
        </if>
        <if test="updateDatetime != null" >
        update_datetime = #{updateDatetime},
        </if>
        <if test="delFlg != null" >
        del_flg = #{delFlg},
        </if>
        <if test="note != null" >
        note = #{note}
        </if>
        where id = #{id}
    </update>

    <select id="getShopByIdAndType" resultMap="ShopResult">
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
        and Id = #{param1}
        <if test="param2 != 0">
            and shop_type = #{param2}
        </if>
    </select>

    <select id="getShopById" resultMap="ShopResult">
        select
        <include refid="Base_Column_List"/>
        from shop
        where
        id = #{shopListId}
        and del_flg = 0;
    </select>

    <select id="getShopByIdList" resultMap="ShopResult">
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
        and id in
        <foreach collection="param1" item="ent" separator="," open="(" close=")">
            #{ent}
        </foreach>
        and publish_start &lt; #{param2}
        and publish_end &gt;= #{param3} ;
    </select>

    <select id="getShopByUuid" resultMap="ShopResult">
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
        and uuid = #{uuid}
    </select>

    <select id="getShopByUuidList" resultMap="ShopResult" parameterType="java.util.List">
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
        and uuid in
        <foreach collection="list" item="ent" separator="," open="(" close=")">
            #{ent}
        </foreach>
    </select>

    <update id="updateShopForNow4ByIdList" >
        update shop set
        now4 = #{param2}
        where id in
        <foreach collection="param1" item="ent" separator="," open="(" close=")">
            #{ent}
        </foreach>
    </update>

    <update id="updateShopForNow5ByIdList" >
        update shop set
        now5 = #{param2}
        where id in
        <foreach collection="param1" item="ent" separator="," open="(" close=")">
            #{ent}
        </foreach>
    </update>

    <delete id="deleteShop" >
        update shop set  publish_end = #{publishEnd},update_datetime = #{updateDatetime},del_flg = 1 where id = #{id}
    </delete>

    <select id="getShopAll" resultMap="ShopResult">
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
    </select>

    <select id="getShopForSettlementBatch" resultMap="ShopResult">
        select
        <include refid="Base_Column_List"/>
        from shop
        where
        publish_start &lt; #{param1}
        and publish_end &gt; #{param2}
    </select>

    <select id="getShopAllForRandom" resultMap="ShopResult">
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
    </select>

    <select id="getCorporate" resultMap="ShopResult">
        select
        <include refid="Base_Column_List"/>
        from shop
        where  shop_type = 8 and  del_flg = 0
    </select>


    <select id="count" resultType="java.lang.Long">
        select count(id)
        from shop
        where del_flg = 0;
    </select>

    <select id="getShopId" resultType="java.lang.Long">
        select id
        from shop
        where
        <if test="_parameter != null and _parameter != 0">
            shop_type = #{_parameter} AND
        </if>
         del_flg = 0
    </select>

    <select id="getShopIdByKeyword" resultType="java.lang.Long">
        select id
        from shop where del_flg = 0
        <if test="param2 != null and param2 != ''">
        and `name` like concat(concat('%',#{param2} ),'%')
        OR excerpt like concat(concat('%',#{param2} ),'%')
        OR address like concat(concat('%',#{param2} ),'%')
        </if>
        <if test="param1 != null and param1 != 0">
        and shop_type = #{param1}
        </if>
    </select>

    <select id="getShopIdByNow4" resultType="java.lang.Long">
        select id
        from shop where del_flg = 0
        <if test="param2 != null ">
            and now4 = 1
        </if>
        <if test="param1 != null and param1 != 0">
            and shop_type = #{param1}
        </if>
    </select>

    <select id="getShopIdByNow5" resultType="java.lang.Long">
        select id
        from shop where del_flg = 0
        <if test="param2 != null ">
            and now5 = 1
        </if>
        <if test="param1 != null and param1 != 0">
            and shop_type = #{param1}
        </if>
    </select>

    <select id="getShopAllByIdListAndCondition" resultMap="ShopResult">
        select
        <include refid="Base_Column_List"/>
        from shop
        where del_flg = 0
        and id in
        <foreach collection="param1" item="ent" separator="," open="(" close=")">
        #{ent}
        </foreach>
        <if test="param2 != null and param2 != ''">
            and name like '%${param2}%'
        </if>
        <if test="param3 > 0">
            and shop_type = #{param3}
        </if>
    </select>

    <select id="getShopAllByCondition" parameterType="jp.co.vermore.form.admin.ShopListForm" resultMap="ShopForListResult">
        select s.id, s.shop_type, s.name, s.address, s.now4, s.now5, s.publish_start, s.publish_end, sd.tel
        from shop s
        inner join shop_detail sd
        on s.id = sd.shop_list_id
        where s.del_flg = 0
        <if test="shopType != null and shopType != 0">
            and s.shop_type = #{shopType}
        </if>
        <if test="name != null and name != '' ">
            and s.name like '%${name}%'
        </if>
        <if test="now4 != null and now4 != 9">
            and s.now4 = #{now4}
        </if>
        <if test="now5 != null and now5 != 9">
            and s.now5 = #{now5}
        </if>
        order by ${orderStatement}
        LIMIT #{length,jdbcType=INTEGER} OFFSET #{start,jdbcType=INTEGER};
    </select>

    <select id="getShopCountByCondition" parameterType="jp.co.vermore.form.admin.ShopListForm" resultType="int">
        select count(s.id) as totalCount
        from shop s
        inner join shop_detail sd
        on s.id = sd.shop_list_id
        where s.del_flg = 0
        <if test="shopType != null and shopType != 0">
            and s.shop_type = #{shopType}
        </if>
        <if test="name != null and name != '' ">
            and s.name like '%${name}%'
        </if>
        <if test="now4 != null and now4 != 9">
            and s.now4 = #{now4}
        </if>
        <if test="now5 != null and now5 != 9">
            and s.now5 = #{now5}
        </if>
    </select>

    <select id="getShopCount" resultType="int">
        select count(id) as totalCount
        from shop
        where del_flg = 0;
    </select>

    <!-- By wangyu -->

    <select id="getIdBybusiness" resultType="Long">
        select s.id
        from shop s,shop_tag st
        where st.shop_id = s.id
        and shop_type = #{param1}
        and tag_type = #{param2}
        and content != #{param3}
        and st.del_flg = 0
        GROUP BY s.id
    </select>

    <select id="getCoordinate" resultMap="ShopResult">
        SELECT
        <include refid="Base_Column_List"/>
        from shop
        WHERE
        del_flg = 0
    </select>
    <!-- By wangyu -->

    <select id="getShopIdByUUID" resultType="Long">
        SELECT id
        FROM shop
        WHERE uuid=#{param1} AND del_flg = 0
    </select>

    <select id="getShopUuidByShopIdShop" resultType="String">
        SELECT uuid from shop
        where id = #{id}
        AND del_flg = 0
    </select>

    <select id="getShopNameByShopIdShop" resultType="String">
        SELECT name from shop
        where id = #{id}
    </select>


</mapper>

        <!--<select id="getShopList" resultMap="ShopResult" parameterType="java.util.Map">-->
        <!--select-->
        <!--<include refid="Base_Column_List"/>-->
        <!--from shop-->
        <!--where del_flg = 0-->
        <!--AND id-->
        <!--in-->
        <!--(select DISTINCT shop_list_id from shop_detail right join shop_tag on shop_detail.id in-->
        <!--(select shop_id from shop_tag where 1=1-->
        <!--<if test="area != null and area.size > 0">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=1-->
        <!--and content in-->
        <!--<foreach collection="area" item="ent" separator="," open="(" close=")">-->
        <!--#{ent,jdbcType=INTEGER}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->
        <!--<if test="dayPriceLow != null and dayPriceLow.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=2-->
        <!--and content &gt;=-->
        <!--<foreach collection="dayPriceLow" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->
        <!--<if test="nightPriceLow != null and nightPriceLow.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=3-->
        <!--and content &gt;=-->
        <!--<foreach collection="nightPriceLow" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->
        <!--<if test="dayPriceHigh != null and dayPriceHigh.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type = 16-->
        <!--and content &lt;=-->
        <!--<foreach collection="dayPriceHigh" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->
        <!--<if test="nightPriceHigh != null and nightPriceHigh.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type = 17-->
        <!--and content &lt;=-->
        <!--<foreach collection="nightPriceHigh" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->
        <!--<if test="shopTime != null and shopTime.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=5-->
        <!--and content &lt;=-->
        <!--<foreach collection="shopTime" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->
        <!--<if test="shopTime != null and shopTime.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=9-->
        <!--and content &gt;=-->
        <!--<foreach collection="shopTime" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->
        <!--<if test="character != null and character.size > 0">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=11-->
        <!--and content in-->
        <!--<foreach collection="character" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->

        <!--<if test="scene != null and category.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=12-->
        <!--and content in-->
        <!--<foreach collection="scene" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->

        <!--<if test="mainMenu != null and mainMenu.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=18-->
        <!--and content in-->
        <!--<foreach collection="mainMenu" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->

        <!--<if test="brand != null and brand.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=20-->
        <!--and content in-->
        <!--<foreach collection="brand" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->

        <!--<if test="seat != null and seat.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=21-->
        <!--and content in-->
        <!--<foreach collection="seat" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->

        <!--<if test="massageTime != null and massageTime.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=22-->
        <!--and content in-->
        <!--<foreach collection="massageTime" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->

        <!--<if test="headCount != null and headCount.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=23-->
        <!--and content in-->
        <!--<foreach collection="headCount" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->

        <!--<if test="roomType != null and roomType.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=24-->
        <!--and content in-->
        <!--<foreach collection="roomType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--and shop_id in (select shop_id from shop_tag where 1=1-->

        <!--<if test="roomNum != null and roomNum.size > 0 ">-->
        <!--and module_type =-->
        <!--<foreach collection="shopType" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag_type=25-->
        <!--and content in-->
        <!--<foreach collection="roomNum" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--)))))))))))))))-->
        <!--))-->
        <!--<if test="keyWord != null and keyWord.size > 0">-->
        <!--and name like concat(concat('%',-->
        <!--<foreach collection="keyWord" item="ent">-->
        <!--#{ent}),-->
        <!--</foreach>-->
        <!--'%')-->
        <!--</if>-->
        <!--<if test="shopType != null and shopType.size > 0">-->
        <!--and shop_type =-->
        <!--<foreach collection="shopType" item="ent">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--</if>-->
        <!--;-->
        <!--</select>-->

        <!--<select id="getShopList" resultMap="ShopResult" parameterType="jp.co.vermore.validation.ShopListParams">-->
        <!--select * from-->

        <!--<if test="shopType != null">-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--where shop.shop_type = #{shopType}-->
        <!--and shop.del_flg = 0-->
        <!--) as r-->
        <!--</if>-->

        <!--<if test="area != null and area.size > 0 and shopType != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--inner join shop_detail as detail on detail.shop_list_id = shop.id-->
        <!--inner join shop_tag as tag on tag.shop_id = detail.id-->
        <!--where tag.content in-->
        <!--<foreach collection="area" item="ent" separator="," open="(" close=")">-->
        <!--#{ent,jdbcType=INTEGER}-->
        <!--</foreach>-->
        <!--and tag.module_type = #{shopType}-->
        <!--and tag.del_flg = 0-->
        <!--and tag.tag_type=1)-->
        <!--as a-->
        <!--</if>-->


        <!--&lt;!&ndash;<if test="area != null and area.size > 0 and shopType = null">&ndash;&gt;-->
        <!--&lt;!&ndash;(select DISTINCT shop.* from shop as shop&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_detail as detail on detail.shop_list_id = shop.id&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_tag as tag on tag.shop_id = detail.id&ndash;&gt;-->
        <!--&lt;!&ndash;AND(tag.content in&ndash;&gt;-->
        <!--&lt;!&ndash;<foreach collection="area" item="ent" separator="," open="(" close=")">&ndash;&gt;-->
        <!--&lt;!&ndash;#{ent,jdbcType=INTEGER}&ndash;&gt;-->
        <!--&lt;!&ndash;</foreach>&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.del_flg = 0&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.tag_type=1)&ndash;&gt;-->
        <!--&lt;!&ndash;) as b inner join&ndash;&gt;-->
        <!--&lt;!&ndash;</if>&ndash;&gt;-->


        <!--<if test="dayPriceLow != null and shopType != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--inner join shop_detail as detail on detail.shop_list_id = shop.id-->
        <!--inner join shop_tag as tag on tag.shop_id = detail.id-->
        <!--AND(tag.content &gt;= #{dayPriceLow}-->
        <!--and tag.module_type = #{shopType}-->
        <!--and tag.del_flg = 0-->
        <!--and tag.tag_type=2)-->
        <!--) as c-->
        <!--</if>-->


        <!--<if test="nightPriceLow != null and shopType != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--inner join shop_detail as detail on detail.shop_list_id = shop.id-->
        <!--inner join shop_tag as tag on tag.shop_id = detail.id-->
        <!--AND( tag.content &gt;= #{nightPriceLow}-->
        <!--and tag.module_type = #{shopType}-->
        <!--and tag.del_flg = 0-->
        <!--and tag.tag_type=3)-->
        <!--) as d-->
        <!--</if>-->


        <!--<if test="dayPriceHigh != null and shopType != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--inner join shop_detail as detail on detail.shop_list_id = shop.id-->
        <!--inner join shop_tag as tag on tag.shop_id = detail.id-->
        <!--AND(tag.content &lt;= #{dayPriceHigh}-->
        <!--and tag.module_type = #{shopType}-->
        <!--and tag.del_flg = 0-->
        <!--and tag.tag_type = 16)-->
        <!--) as e-->
        <!--</if>-->


        <!--<if test="nightPriceHigh != null and shopType != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--inner join shop_detail as detail on detail.shop_list_id = shop.id-->
        <!--inner join shop_tag as tag on tag.shop_id = detail.id-->
        <!--AND(tag.content &lt;= #{nightPriceHigh}-->
        <!--and tag.module_type = #{shopType}-->
        <!--and tag.del_flg = 0-->
        <!--and tag.tag_type = 17)-->
        <!--) as f-->
        <!--</if>-->


        <!--<if test="shopTime != null  and shopType != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--inner join shop_detail as detail on detail.shop_list_id = shop.id-->
        <!--inner join shop_tag as tag on tag.shop_id = detail.id-->
        <!--AND(tag.content &lt;= #{shopTime}-->
        <!--and tag.module_type = #{shopType}-->
        <!--and tag.del_flg = 0-->
        <!--and tag.tag_type=5)-->
        <!--) as g-->
        <!--</if>-->


        <!--<if test="shopTime != null and shopType != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--inner join shop_detail as detail on detail.shop_list_id = shop.id-->
        <!--inner join shop_tag as tag on tag.shop_id = detail.id-->
        <!--AND(tag.content &gt;=#{shopTime}-->
        <!--and tag.module_type = #{shopType}-->
        <!--and tag.del_flg = 0-->
        <!--and tag.tag_type=9)-->
        <!--) as h-->
        <!--</if>-->


        <!--<if test="character != null and character.size > 0 and shopType != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--inner join shop_detail as detail on detail.shop_list_id = shop.id-->
        <!--inner join shop_tag as tag on tag.shop_id = detail.id-->
        <!--AND(tag.content in-->
        <!--<foreach collection="character" item="ent" separator="," open="(" close=")">-->
        <!--#{ent}-->
        <!--</foreach>-->
        <!--and tag.module_type = #{shopType}-->
        <!--and tag.del_flg = 0-->
        <!--and tag.tag_type=11)-->
        <!--) as i-->
        <!--</if>-->

        <!--<if test="mainMenu != null and shopType != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--inner join shop_detail as detail on detail.shop_list_id = shop.id-->
        <!--inner join shop_tag as tag on tag.shop_id = detail.id-->
        <!--AND(tag.content =  #{mainMenu}-->
        <!--and tag.module_type = #{shopType}-->
        <!--and tag.del_flg = 0-->
        <!--and tag.tag_type=18)-->
        <!--) as k-->
        <!--</if>-->

        <!--&lt;!&ndash;(select DISTINCT shop.* from shop as shop&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_detail as detail on detail.shop_list_id = shop.id&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_tag as tag on tag.shop_id = detail.id&ndash;&gt;-->
        <!--&lt;!&ndash;<if test="scene != null ">&ndash;&gt;-->
        <!--&lt;!&ndash;AND(tag.content = #{scene}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.module_type = #{shopType}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.del_flg = 0&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.tag_type=12)&ndash;&gt;-->
        <!--&lt;!&ndash;</if>) as j inner join&ndash;&gt;-->


        <!--&lt;!&ndash;(select DISTINCT shop.* from shop as shop&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_detail as detail on detail.shop_list_id = shop.id&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_tag as tag on tag.shop_id = detail.id&ndash;&gt;-->
        <!--&lt;!&ndash;<if test="brand != null ">&ndash;&gt;-->
        <!--&lt;!&ndash;AND(tag.content in&ndash;&gt;-->
        <!--&lt;!&ndash;<foreach collection="brand" item="ent" separator="," open="(" close=")">&ndash;&gt;-->
        <!--&lt;!&ndash;#{ent}&ndash;&gt;-->
        <!--&lt;!&ndash;</foreach>&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.module_type = #{shopType}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.del_flg = 0&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.tag_type=20)&ndash;&gt;-->
        <!--&lt;!&ndash;</if>) as l inner join&ndash;&gt;-->

        <!--&lt;!&ndash;(select DISTINCT shop.* from shop as shop&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_detail as detail on detail.shop_list_id = shop.id&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_tag as tag on tag.shop_id = detail.id&ndash;&gt;-->
        <!--&lt;!&ndash;<if test="seat != null ">&ndash;&gt;-->
        <!--&lt;!&ndash;AND(tag.content = #{seat}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.module_type = #{shopType}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.del_flg = 0&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.tag_type=21)&ndash;&gt;-->
        <!--&lt;!&ndash;</if>) as m inner join&ndash;&gt;-->

        <!--&lt;!&ndash;(select DISTINCT shop.* from shop as shop&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_detail as detail on detail.shop_list_id = shop.id&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_tag as tag on tag.shop_id = detail.id&ndash;&gt;-->
        <!--&lt;!&ndash;<if test="massageTime != null  ">&ndash;&gt;-->
        <!--&lt;!&ndash;AND(tag.content = #{massageTime}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.module_type = #{shopType}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.del_flg = 0&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.tag_type=22)&ndash;&gt;-->
        <!--&lt;!&ndash;</if>) as n inner join&ndash;&gt;-->

        <!--&lt;!&ndash;(select DISTINCT shop.* from shop as shop&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_detail as detail on detail.shop_list_id = shop.id&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_tag as tag on tag.shop_id = detail.id&ndash;&gt;-->
        <!--&lt;!&ndash;<if test="headCount != null ">&ndash;&gt;-->
        <!--&lt;!&ndash;AND(tag.content = #{headCount}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.module_type = #{shopType}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.del_flg = 0&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.tag_type=23)&ndash;&gt;-->
        <!--&lt;!&ndash;</if>) as o inner join&ndash;&gt;-->

        <!--&lt;!&ndash;(select DISTINCT shop.* from shop as shop&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_detail as detail on detail.shop_list_id = shop.id&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_tag as tag on tag.shop_id = detail.id&ndash;&gt;-->
        <!--&lt;!&ndash;<if test="roomType != null ">&ndash;&gt;-->
        <!--&lt;!&ndash;AND(tag.content = #{roomType}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.module_type = #{shopType}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.del_flg = 0&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.tag_type=24)&ndash;&gt;-->
        <!--&lt;!&ndash;</if>) as p inner join&ndash;&gt;-->

        <!--&lt;!&ndash;(select DISTINCT shop.* from shop as shop&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_detail as detail on detail.shop_list_id = shop.id&ndash;&gt;-->
        <!--&lt;!&ndash;inner join shop_tag as tag on tag.shop_id = detail.id&ndash;&gt;-->
        <!--&lt;!&ndash;<if test="roomNum != null  ">&ndash;&gt;-->
        <!--&lt;!&ndash;AND(tag.content = #{roomNum}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.module_type = #{shopType}&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.del_flg = 0&ndash;&gt;-->
        <!--&lt;!&ndash;and tag.tag_type=25)&ndash;&gt;-->
        <!--&lt;!&ndash;</if>) as q inner join&ndash;&gt;-->




        <!--<if test="now4 != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--where shop.now4 = #{now4}-->
        <!--and shop.del_flg = 0-->
        <!--) as s-->
        <!--</if>-->


        <!--<if test="now5 != null ">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--where shop.now5 =#{now5}-->
        <!--and shop.del_flg = 0-->
        <!--) as t-->
        <!--</if>-->


        <!--<if test="keyWord != null">-->
        <!--inner join-->
        <!--(select DISTINCT shop.* from shop as shop-->
        <!--where shop.name like concat(concat('%',-->
        <!--#{keyWord}),-->
        <!--'%')-->
        <!--) as u-->
        <!--</if>-->

        <!--where 1 = 1-->
        <!--<if test="shopType != null and area != null and area.size > 0">-->
        <!--and  a.id = r.id-->
        <!--</if>-->
        <!--<if test="   dayPriceLow != null and shopType != null">-->
        <!--and r.id = c.id-->
        <!--</if>-->
        <!--<if test="nightPriceLow != null  and shopType != null">-->
        <!--and r.id = d.id-->
        <!--</if>-->
        <!--<if test="dayPriceHigh != null  and shopType != null">-->
        <!--and r.id = e.id-->
        <!--</if>-->
        <!--<if test="nightPriceHigh != null  and shopType != null">-->
        <!--and  r.id = f.id-->
        <!--</if>-->
        <!--<if test="shopTime != null  and shopType != null">-->
        <!--and r.id = g.id-->
        <!--</if>-->
        <!--<if test="shopTime != null  and shopType != null">-->
        <!--and r.id = h.id-->
        <!--</if>-->
        <!--<if test="character != null  and shopType != null">-->
        <!--and  r.id = i.id-->
        <!--</if>-->
        <!--<if test="mainMenu != null  and shopType != null">-->
        <!--and r.id = k.id-->
        <!--</if>-->
        <!--<if test="now4 != null  and shopType != null">-->
        <!--and r.id = s.id-->
        <!--</if>-->
        <!--<if test="now5 != null  and shopType != null">-->
        <!--and r.id = t.id-->
        <!--</if>-->
        <!--<if test="keyWord != null  and shopType != null">-->
        <!--and r.id = u.id-->
        <!--</if>-->

        <!--<if test="limit != null ">-->
        <!--limit #{limit}-->
        <!--</if>-->
        <!--<if test="offset != null">-->
        <!--offset  #{offset}-->
        <!--</if>-->

        <!--</select>-->