<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jp.co.vermore.mapper.FreePaperMapper" >
  <resultMap id="FreePaperResultMap" type="jp.co.vermore.entity.FreePaper" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 20 09:11:04 CST 2018.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="uuid" property="uuid" jdbcType="VARCHAR"/>
    <result column="date" property="date" jdbcType="INTEGER" />
    <result column="volume" property="volume" jdbcType="INTEGER" />
    <result column="pic_url" property="picUrl" jdbcType="VARCHAR" />
    <result column="title" property="title" jdbcType="VARCHAR" />
    <result column="sort_score" property="sortScore" jdbcType="INTEGER" />
    <result column="publish_start" property="publishStart" jdbcType="TIMESTAMP" />
    <result column="publish_end" property="publishEnd" jdbcType="TIMESTAMP" />
    <result column="create_datetime" property="createDatetime" jdbcType="TIMESTAMP" />
    <result column="update_datetime" property="updateDatetime" jdbcType="TIMESTAMP" />
    <result column="del_flg" property="delFlg" jdbcType="BIT" />
    <result column="note" property="note" jdbcType="VARCHAR" />
  </resultMap>

  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 20 09:11:04 CST 2018.
    -->
    id, uuid, date, volume, pic_url, title, sort_score, publish_start, publish_end,
    create_datetime, update_datetime, del_flg, note
  </sql>

  <select id="getFreePaperJsonAll" resultMap="FreePaperResultMap">
    select
    <include refid="Base_Column_List" />
    from free_paper
    where del_flg = 0
    and publish_start &lt; #{param1}
    and publish_end &gt;= #{param2}
    order by volume DESC
    LIMIT #{param3} OFFSET #{param4};
  </select>

  <select id="getFreePaperAll" resultMap="FreePaperResultMap">
    select
    <include refid="Base_Column_List" />
    from free_paper
    where del_flg = 0
  </select>

  <select id="getFreePaperById" resultMap="FreePaperResultMap">
    select
    <include refid="Base_Column_List" />
    from free_paper
    where id = #{id} and del_flg = 0
  </select>

  <select id="getFreePaperByUuid" resultMap="FreePaperResultMap">
    select
    <include refid="Base_Column_List" />
    from free_paper
    where uuid = #{uuid} and del_flg = 0
  </select>

  <select id="getFreePaperByYear" resultMap="FreePaperResultMap">
    select
    <include refid="Base_Column_List" />
    from free_paper
    where del_flg = 0
    and publish_start &lt; #{param2}
    and publish_end &gt;= #{param3}
    <if test="param1 != null and param1 !=''">
    and year( free_paper.date ) = #{param1}
    </if>
    LIMIT #{param4} OFFSET #{param5};
  </select>

  <select id="getFreePaperForTop" resultMap="FreePaperResultMap">
    select
    <include refid="Base_Column_List" />
    from free_paper
    where del_flg = 0
    order by volume desc
    LIMIT 5
  </select>

  <insert id="insertFreePaper">
    insert into free_paper(
    uuid,
    title,
    volume,
    pic_url,
    date,
    sort_score,
    publish_start,
    publish_end,
    create_datetime,
    update_datetime,
    del_flg,
    note
    ) values (
    #{uuid},
    #{title},
    #{volume},
    #{picUrl},
    #{date},
    #{sortScore},
    #{publishStart},
    #{publishEnd},
    #{createDatetime},
    #{updateDatetime},
    #{delFlg},
    #{note}
    )
    <selectKey resultType="long" keyProperty="id" order="AFTER">
      select @@IDENTITY
    </selectKey>
  </insert>

  <update id="updateFreePaper" parameterType="jp.co.vermore.entity.FreePaper" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 28 15:54:28 CST 2018.
    -->
    update free_paper
    <set >
      <if test="uuid != null" >
        uuid = #{uuid,jdbcType=VARCHAR},
      </if>
      <if test="title != null" >
        title = #{title},
      </if>
      <if test="volume != null" >
        volume = #{volume},
      </if>
      <if test="date != null" >
        date = #{date},
      </if>
      <if test="sortScore != null" >
          sort_score = #{sortScore},
      </if>
      <if test="publishStart != null" >
        publish_start = #{publishStart,jdbcType=TIMESTAMP},
      </if>
      <if test="publishEnd != null" >
        publish_end = #{publishEnd,jdbcType=TIMESTAMP},
      </if>
      <if test="createDatetime != null" >
        create_datetime = #{createDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateDatetime != null" >
        update_datetime = #{updateDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="delFlg != null" >
        del_flg = #{delFlg,jdbcType=BIT},
      </if>
      <if test="note != null" >
        note = #{note,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>

    <delete id="deleteFreePaper">
        update free_paper set del_flg = 1 where id = #{id}
    </delete>

  <select id="getFreePaperAllByCondition" parameterType="jp.co.vermore.form.admin.FreePaperListForm" resultMap="FreePaperResultMap">
    select *
    from free_paper
    where del_flg = 0
    <if test="volume != null">
      and `volume` = #{volume}
    </if>
    <if test="date != null">
      and date_format(`date`,'%Y-%m-%d') =date_format(#{date},'%Y-%m-%d')
    </if>
    <if test="sortScore != null and sortScore != 9">
      and sort_score = #{sortScore}
    </if>
    <if test="publishStart != null">
      and date_format(publish_start,'%Y-%m-%d') &gt;= date_format(#{publishStart},'%Y-%m-%d')
    </if>
    <if test="publishEnd != null">
      and date_format(publish_end,'%Y-%m-%d') &lt;= date_format(#{publishEnd},'%Y-%m-%d')
    </if>
    order by ${orderStatement}
    LIMIT #{length,jdbcType=INTEGER} OFFSET #{start,jdbcType=INTEGER};
  </select>

  <select id="getFreePaperCountByCondition" parameterType="jp.co.vermore.form.admin.FreePaperListForm" resultType="int">
    select count(id) as totalCount
    from free_paper
    where del_flg = 0
    <if test="volume != null">
      and `volume` = #{volume}
    </if>
    <if test="date != null">
      and date_format(`date`,'%Y-%m-%d') =date_format(#{date},'%Y-%m-%d')
    </if>
    <if test="sortScore != null and sortScore != 9">
      and sort_score = #{sortScore}
    </if>
    <if test="publishStart != null">
      and date_format(publish_start,'%Y-%m-%d') &gt;= date_format(#{publishStart},'%Y-%m-%d')
    </if>
    <if test="publishEnd != null">
      and date_format(publish_end,'%Y-%m-%d') &lt;= date_format(#{publishEnd},'%Y-%m-%d')
    </if>
  </select>

  <select id="getFreePaperCount" resultType="int">
    select count(id) as totalCount
    from free_paper
    where del_flg = 0;
  </select>

</mapper>