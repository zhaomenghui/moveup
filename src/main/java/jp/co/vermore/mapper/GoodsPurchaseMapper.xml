<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jp.co.vermore.mapper.GoodsPurchaseMapper" >
  <resultMap id="GoodsPurchaseResult" type="jp.co.vermore.entity.GoodsPurchase" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 06 17:20:28 CST 2018.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="user_id" property="userId" jdbcType="INTEGER" />
    <result column="goods_id" property="goodsId" jdbcType="INTEGER" />
    <result column="size" property="size" jdbcType="TINYINT" />
    <result column="colors" property="colors" jdbcType="TINYINT" />
    <result column="price" property="price" jdbcType="INTEGER" />
    <result column="coin" property="coin" jdbcType="INTEGER" />
    <result column="quantity" property="quantity" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="serial_number" property="serialNumber" jdbcType="VARCHAR" />
    <result column="create_datetime" property="createDatetime" jdbcType="TIMESTAMP" />
    <result column="update_datetime" property="updateDatetime" jdbcType="TIMESTAMP" />
    <result column="del_flg" property="delFlg" jdbcType="BIT" />
    <result column="note" property="note" jdbcType="VARCHAR" />
  </resultMap>

  <insert id="insertGoodsPurchase" parameterType="jp.co.vermore.entity.GoodsPurchase">
    insert into
    goods_purchase(
    user_id,
    goods_id,
    size,
    colors,
    price,
    coin,
    quantity,
    status,
    serial_number,
    create_datetime,
    del_flg,
    note
    ) values (
    #{userId},
    #{goodsId},
    #{size},
    #{colors},
    #{price},
    #{coin},
    #{quantity},
    #{status},
    #{serialNumber},
    #{createDatetime},
    #{delFlg},
    #{note}
    )
    <selectKey resultType="long" keyProperty="id" order="AFTER">
      select @@IDENTITY
    </selectKey>
  </insert>

  <select id="getGoodsPurchase" resultMap="GoodsPurchaseResult">
    select
    *
    from
    goods_purchase
    where del_flg = 0
    and user_id = #{param1}
    <if test="param2 != null and param2 !=''">
    and status = #{param2}
    </if>
  </select>

  <select id="getGoodsPurchaseHistoryAll" resultMap="GoodsPurchaseResult">
    select
    *
    from
    goods_purchase
    where del_flg = 0
    and status != 11;
  </select>

  <select id="getGoodsPurchaseHistory" resultMap="GoodsPurchaseResult">
    select
    *
    from
    goods_purchase
    where  serial_number = #{serialNumber}
    and status != 11
    and del_flg = 0
    order by update_datetime;
  </select>

  <select id="getGoodsSerialNumber" resultMap="GoodsPurchaseResult">
    select
    distinct serial_number
    from
    goods_purchase
    where  user_id = #{userId}
    and status != 11
    and del_flg = 0
    order by update_datetime desc
  </select>


  <select id="getGoodsPurchaseById" resultMap="GoodsPurchaseResult">
    select
    *
    from
    goods_purchase
    where id = #{id}
  </select>

  <update id="updateGoodsPurchase" parameterType="jp.co.vermore.entity.GoodsPurchase" >
    update goods_purchase
    <set>
      status = #{param2}
    </set>
    where serial_number = #{param1}
  </update>

  <select id="getGoodsPurchaseAllByCondition" parameterType="jp.co.vermore.form.admin.GoodsPurchaseListForm" resultMap="GoodsPurchaseResult">
    select gp.*
    from goods_purchase gp
    inner join goods_detail gd
    on gp.goods_id = gd.goods_id
    <if test="goodsName != null and goodsName != ''">
      and gd.name like '%${goodsName}%'
    </if>
    where gp.del_flg = 0
    <if test="serialNumber != null and serialNumber != ''">
      and gp.serial_number = #{serialNumber}
    </if>
    <if test="status != null and status != 99 and status != 11">
      and gp.status = #{status}
    </if>
    and gp.status != 11
    order by ${orderStatement}
    LIMIT #{length,jdbcType=INTEGER} OFFSET #{start,jdbcType=INTEGER};
  </select>

  <select id="getGoodsPurchaseCountByCondition" parameterType="jp.co.vermore.form.admin.GoodsPurchaseListForm" resultType="int">
    select count(gp.id) as totalCount
    from goods_purchase gp
    inner join goods_detail gd
    on gp.goods_id = gd.goods_id
    <if test="goodsName != null and goodsName != ''">
      and gd.name like '%${goodsName}%'
    </if>
    where gp.del_flg = 0
    <if test="serialNumber != null and serialNumber != ''">
      and gp.serial_number = #{serialNumber}
    </if>
    <if test="status != null and status != 99 and status != 11">
      and gp.status = #{status}
    </if>
    and gp.status != 11
  </select>

  <select id="getGoodsPurchaseCount" resultType="int">
    select count(id) as totalCount
    from goods_purchase
    where del_flg = 0;
  </select>

  <update id="updateByPrimaryKeySelective" parameterType="jp.co.vermore.entity.GoodsPurchase" >
    update goods_purchase
    <set >
      <if test="userId != null" >
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="goodsId != null" >
        goods_id = #{goodsId,jdbcType=INTEGER},
      </if>
      <if test="price != null" >
        price = #{price,jdbcType=INTEGER},
      </if>
      <if test="coin != null" >
        coin = #{coin,jdbcType=INTEGER},
      </if>
      <if test="quantity != null" >
        quantity = #{quantity,jdbcType=INTEGER},
      </if>
      <if test="size != null" >
        size = #{size,jdbcType=TINYINT},
      </if>
      <if test="colors != null" >
        colors = #{colors,jdbcType=TINYINT},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="serialNumber != null" >
        serial_number = #{serialNumber,jdbcType=VARCHAR},
      </if>
      <if test="createDatetime != null" >
        create_datetime = #{createDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateDatetime != null" >
        update_datetime = #{updateDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="delFlg != null" >
        del_flg = #{delFlg,jdbcType=BIT},
      </if>
      <if test="note != null" >
        note = #{note,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
    <selectKey resultType="long" keyProperty="id" order="AFTER">
      select @@IDENTITY
    </selectKey>
  </update>

  <update id="updateBySerialNumberSelective" parameterType="jp.co.vermore.entity.GoodsPurchase" >
    update goods_purchase
    <set >
      <if test="userId != null" >
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="goodsId != null" >
        goods_id = #{goodsId,jdbcType=INTEGER},
      </if>
      <if test="price != null" >
        price = #{price,jdbcType=INTEGER},
      </if>
      <if test="coin != null" >
        coin = #{coin,jdbcType=INTEGER},
      </if>
      <if test="quantity != null" >
        quantity = #{quantity,jdbcType=INTEGER},
      </if>
      <if test="size != null" >
        size = #{size,jdbcType=TINYINT},
      </if>
      <if test="colors != null" >
        colors = #{colors,jdbcType=TINYINT},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="serialNumber != null" >
        serial_number = #{serialNumber,jdbcType=VARCHAR},
      </if>
      <if test="createDatetime != null" >
        create_datetime = #{createDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateDatetime != null" >
        update_datetime = #{updateDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="delFlg != null" >
        del_flg = #{delFlg,jdbcType=BIT},
      </if>
      <if test="note != null" >
        note = #{note,jdbcType=VARCHAR},
      </if>
    </set>
    where serial_number = #{serialNumber,jdbcType=VARCHAR}
    <selectKey resultType="long" keyProperty="id" order="AFTER">
      select @@IDENTITY
    </selectKey>
  </update>


</mapper>